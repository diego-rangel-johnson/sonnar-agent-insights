name: Test Secrets Configuration

on:
  workflow_dispatch: # Permite executar manualmente

jobs:
  test-secrets:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout c√≥digo
      uses: actions/checkout@v4
      
    - name: Test Supabase URL Secret
      run: |
        if [ -z "$VITE_SUPABASE_URL" ]; then
          echo "‚ùå VITE_SUPABASE_URL n√£o est√° configurado ou est√° vazio"
          exit 1
        else
          echo "‚úÖ VITE_SUPABASE_URL est√° configurado"
          echo "URL length: ${#VITE_SUPABASE_URL} caracteres"
          echo "URL starts with: ${VITE_SUPABASE_URL:0:20}..."
        fi
      env:
        VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL }}
        
    - name: Test Supabase Anon Key Secret
      run: |
        if [ -z "$VITE_SUPABASE_ANON_KEY" ]; then
          echo "‚ùå VITE_SUPABASE_ANON_KEY n√£o est√° configurado ou est√° vazio"
          exit 1
        else
          echo "‚úÖ VITE_SUPABASE_ANON_KEY est√° configurado"
          echo "Key length: ${#VITE_SUPABASE_ANON_KEY} caracteres"
          echo "Key starts with: ${VITE_SUPABASE_ANON_KEY:0:20}..."
        fi
      env:
        VITE_SUPABASE_ANON_KEY: ${{ secrets.VITE_SUPABASE_ANON_KEY }}
        
    - name: Test Connection to Supabase
      run: |
        echo "üîó Testando conex√£o com Supabase..."
        response=$(curl -s -o /dev/null -w "%{http_code}" "$VITE_SUPABASE_URL/rest/v1/" \
          -H "apikey: $VITE_SUPABASE_ANON_KEY" \
          -H "Authorization: Bearer $VITE_SUPABASE_ANON_KEY")
        
        if [ "$response" = "200" ]; then
          echo "‚úÖ Conex√£o com Supabase OK (HTTP $response)"
        else
          echo "‚ö†Ô∏è  Resposta HTTP: $response"
          echo "Isso pode ser normal dependendo da configura√ß√£o do seu projeto"
        fi
      env:
        VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL }}
        VITE_SUPABASE_ANON_KEY: ${{ secrets.VITE_SUPABASE_ANON_KEY }}
        
    - name: Validate Secret Values
      run: |
        echo "üîç Validando formato dos secrets..."
        
        # Validar URL do Supabase
        if [[ "$VITE_SUPABASE_URL" =~ ^https://[a-z0-9]+\.supabase\.co$ ]]; then
          echo "‚úÖ Formato da URL Supabase est√° correto"
        else
          echo "‚ùå Formato da URL Supabase parece incorreto"
          echo "Esperado: https://[project-id].supabase.co"
        fi
        
        # Validar chave an√¥nima (JWT format)
        if [[ "$VITE_SUPABASE_ANON_KEY" =~ ^eyJ[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+$ ]]; then
          echo "‚úÖ Formato da chave an√¥nima est√° correto (JWT)"
        else
          echo "‚ùå Formato da chave an√¥nima parece incorreto"
          echo "Esperado: JWT format (eyJ...)"
        fi
      env:
        VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL }}
        VITE_SUPABASE_ANON_KEY: ${{ secrets.VITE_SUPABASE_ANON_KEY }} 